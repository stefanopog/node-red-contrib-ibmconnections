<script type="text/javascript">
/*
Copyright IBM All Rights Reserved.

SPDX-License-Identifier: Apache-2.0
*/
    RED.nodes.registerType(
        'ICProfilesGet',
        {
            category: "IBMsocial",
            inputs: 1,
            outputs:1,
            icon: "ibmconnections.png",
            color: "#FFFFFF",
            label: function() {
                    return this.name ||'Get Profiles';
            },
            paletteLabel : "Get Profiles",
            defaults : {
                name: {
                    value: ""
                },
                server: {
                    value: "",
                    required: true,
                    type: "ICLogin2"
                },
                target: {
                    value: "myself",
                    required: true
                },
                targetValue: {
                    value: "",
                    required: false
                },
                mytags: {
                    value: "",
                    required: false
                },
                mykeywords: {
                    value: "",
                    required: false
                },
                freesyntax: {
                    value: "",
                    required: false
                },
                photoBytes: {
                    value: false,
                    required: false
                },
                audio: {
                    value: false,
                    required: false
                },
                links: {
                    value: false,
                    required: false
                },
                adminOutput: {
                    value: false,
                    required: false
                }
            },
            oneditprepare: __IC_updateFormProfilesGet
        });

    function __IC_updateFormProfilesGet() {
        if ((this.audio === undefined) || (this.audio === null)) {
            this.audio = false;
            document.querySelector("#node-input-audio").value = false;
            document.querySelector("#node-input-audio").checked = false;
        }
        if ((this.adminOutput === undefined) || (this.adminOutput === null)) {
            this.adminOutput = false;
            document.querySelector("#node-input-adminOutput").value = false;
            document.querySelector("#node-input-adminOutput").checked = false;
        }
        __IC_updateTargetProfilesGet();
        __IC_updateUserInformation();
    }

    function __IC_updateUserInformation() {
        if (document.querySelector("#node-input-adminOutput").checked) {
            document.querySelector("#userInformation").style.display = "block";
        } else {
            document.querySelector("#userInformation").style.display = "none";
        }
    }
    function __IC_updateTargetProfilesGet() {
       switch (document.querySelector("#node-input-target").value) {
           case 'person' :
	           document.querySelector("#targetRow").style.display = "block";
               document.querySelector("#tagRow").style.display = "none";
               document.querySelector("#keywordRow").style.display = "none";
               document.querySelector("#syntaxRow").style.display = "none";
               document.querySelector("#adminOutput").style.visibility = "initial";
               break;
           case 'myself' :
               document.querySelector("#targetRow").style.display = "none";
               document.querySelector("#tagRow").style.display = "none";
               document.querySelector("#keywordRow").style.display = "none";
               document.querySelector("#syntaxRow").style.display = "none";
               document.querySelector("#adminOutput").style.visibility = "initial";
               break;
           case 'byTag' :
               document.querySelector("#targetRow").style.display = "none";
               document.querySelector("#tagRow").style.display = "block";
               document.querySelector("#keywordRow").style.display = "none";
               document.querySelector("#syntaxRow").style.display = "none";
               document.querySelector("#adminOutput").style.visibility = "hidden";
               break;
           case 'byKeyword' :
               document.querySelector("#targetRow").style.display = "none";
               document.querySelector("#tagRow").style.display = "none";
               document.querySelector("#keywordRow").style.display = "block";
               document.querySelector("#syntaxRow").style.display = "none";
               document.querySelector("#adminOutput").style.visibility = "hidden";
              break;
           case 'syntaxSearch' :
               document.querySelector("#targetRow").style.display = "none";
               document.querySelector("#tagRow").style.display = "none";
               document.querySelector("#keywordRow").style.display = "none";
               document.querySelector("#syntaxRow").style.display = "block";
               document.querySelector("#adminOutput").style.visibility = "hidden";
               break;
       }
   }
</script>

<script type="text/x-red" data-template-name="ICProfilesGet">
    <div class="form-row">
        <label for="node-input-server"><i class="fa fa-server"></i> Server</label>
        <input type="text" id="node-input-server" placeholder="Server">
    </div>

    <div class="form-row">
        <label for="node-input-target"><i class="fa fa-arrow-circle-right"></i> Target</label>
        <select id="node-input-target" onchange="__IC_updateTargetProfilesGet()">
	       <option value="myself">Me</option>
	       <option value="person">Someone else</option>
	       <option value="byTag">Search By Tag</option>
	       <option value="byKeyword">Search By Keyword</option>
	       <option value="syntaxSearch">Free Syntax</option>
        </select>
    </div>
    <div class="form-row" id="targetRow">
        <label for="node-input-targetValue"><i class="fa fa-odnoklassniki"></i> Users</label>
        <input type="text" id="node-input-targetValue" placeholder="comma-separated list of User ID or Emails"></input>
    </div>

    <div class="form-row" id="tagRow">
        <label for="node-input-mytags"><i class="fa fa-tag"></i> Tags</label>
        <input type="text" id="node-input-mytags" placeholder="tags"></input>
    </div>

    <div class="form-row" id="keywordRow">
        <label for="node-input-mykeywords"><i class="fa fa-tag"></i> Keywords</label>
        <input type="text" id="node-input-mykeywords" placeholder="keywords"></input>
    </div>

    <div class="form-row" id="syntaxRow">
        <label for="node-input-freesyntax"><i class="fa fa-tag"></i> Free Syntax</label>
        <input type="text" id="node-input-freesyntax" placeholder="syntax"></input>
    </div>

    <br/>
    <br/>


    <label><b>Output Options</b></label>
    <hr style="margin:5px; border-color:black"/>

    <div class="form-row">
        <label for="node-input-photoBytes"><i class="fa fa-file-image-o" style="width: initial"></i> Full photo</label>
        <input style="display: inline-block; width: initial; vertical-align: top;" type="checkbox" name="photoBytes" id="node-input-photoBytes"></input>
    </div>
    <div class="form-row">
        <label for="node-input-links"><i class="fa fa-file-audio-o" style="width: initial"></i> Audio</label>
        <input style="display: inline-block; width: initial; vertical-align: top;" type="checkbox" name="audio" id="node-input-audio"></input>
    </div>
    <div class="form-row">
        <label for="node-input-links"><i class="fa fa-link" style="width: initial"></i> Linkroll</label>
        <input style="display: inline-block; width: initial; vertical-align: top;" type="checkbox" name="links" id="node-input-links"></input>
    </div>
    <div class="form-row" id="adminOutput" onchange="__IC_updateUserInformation()">
        <label for="node-input-adminOutput" style="width:fit-content"><i class="fa fa-battery-full" style="width: initial"></i> Admin Output</label>
        <input style="display: inline-block; width: initial; vertical-align: top;" type="checkbox" name="links" id="node-input-adminOutput"></input>
    </div>

    <div class="form-tips" id="userInformation" style="display:none">
        <h4>Tip</h4>
        <p>Please verify that you have the ADMIN RIGHTS on the Profile application !</p>
    </div>
    
    <hr style="margin:5px; border-color:black"//>
    <br/>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</span></label>
        <input type="text" id="node-input-name" ></input>
    </div>

</script>

<script type="text/x-red" data-help-name="ICProfilesGet">
    <p>
        A node that allows you to retrieve the information about one or more IBM Connections Profiles. 
        <br />
        The following functionalities are available:
        <ul>
            <li>
                Retrieves the details of the profile of the user associated with the <b>Login node</b>
            </li>
            <li>
                Retrieves the details of the profile of one or more users identified by their mail address or their IBM Connections's userid  (you can use both interchangeably)
            </li>
            <li>
                Retrieves the details of multiple profiles, associated with a combination of <b>Tags</b> or <b>Keywords</b> or by an IBM Connections's <b>Search string</b>
            </li>
        </ul>
        <br />
        See the <strong>Output</strong> section of this help to learn which information can be returned by this node.
    </p>

    <h3>Inputs</h3>
    <dl class="message-properties">
        <dt class="optional">msg.IC_target
            <span class="property-type">comma-separated string</span>
        </dt>
        <dd>
            In case you choose to get the profile information for <b style="color:red">someone else</b>, you need to specify a comma-separated list of <code>IBM Connections's userId</code> or <code>email address</code> for
            the people you want to retrieve. The node is able to automatically distinguish between userIds and email addresses and you can mix them.
            <br />
            If only one user is specified, the <code>msg.payload</code> output will be a single object (or <b>null</b> if the user is not found); otherwise, <code>msg.payload</code> 
            will be an array of objects (or an <b>empty array</b> if no users are found).
            <br />
            The value from the <b>node's Configuration Panel</b> takes precedence on the <code>msg.IC_target</code> attribute.
        </dd>

        <dt class="optional">msg.IC_tags
            <span class="property-type">comma-separated string</span>
        </dt>
        <dd>
            In case you choose to get the profile information matching a <b style="color:red">combination of Tags</b>, you need to specify a comma-separated list of <code>tags</code>. 
            <br />
            the <code>msg.payload</code> result is always an array of objects (or an <b>empty array</b> if no users are found).
            <br />
            The value from the <b>node's Configuration Panel</b> takes precedence on the <code>msg.IC_tags</code> attribute.
        </dd>

        <dt class="optional">msg.IC_keywords
            <span class="property-type">comma-separated string</span>
        </dt>
        <dd>
            In case you choose to get the profile information matching a <b style="color:red">combination of Keywords</b>, you need to specify a comma-separated list of <code>keywords</code>. 
            <br />
            the <code>msg.payload</code> result is always an array of objects (or an <b>empty array</b> if no users are found).
            <br />
            The value from the <b>node's Configuration Panel</b> takes precedence on the <code>msg.IC_keywords</code> attribute.
        </dd>

        <dt class="optional">msg.IC_freeSyntax
            <span class="property-type">string</span>
        </dt>
        <dd>
            In case you choose to get the profile information matching an <b style="color:red">IBM Connections's search criteria</b>, you need to specify a string defining the <code>search criteria</code>. 
            <br />
            the <code>msg.payload</code> result is always an array of objects (or an <b>empty array</b> if no users are found).
            <br />
            The value from the <b>node's Configuration Panel</b> takes precedence on the <code>msg.IC_freeSyntax</code> attribute.
        </dd>    
    </dl>

    <h3>Output Options</h3>
    <dl class="message-properties">
        <dt>Full Photo
            <span class="property-type">checkbox</span>
        </dt>
        <dd>
            when this checkbox is set, the node retrieves the content of the Profile Image. This content can be dumped onto a <code>JPG File</code> to get the File version
        </dd>

        <dt>Audio
            <span class="property-type">checkbox</span>
        </dt>
        <dd>
            when this checkbox is set, the node retrieves the content of the Pronounciation (if it exists) associated to the profile. This content can be dumped onto a <code>WAV File</code> to get the File version
        </dd>

        <dt>Linkroll
            <span class="property-type">checkbox</span>
        </dt>
        <dd>
            when this checkbox is set, the node retrieves the Linkroll (if it exists) associated to the profile. 
        </dd>

        <dt>Admin Output
            <span class="property-type">checkbox</span>
        </dt>
        <dd>
            when this checkbox is set, the structure of the <code>allAttributes</code> output attribute reflects the information returned by the <strong>Profiles Administration APIs</strong> (as opposed
            to the <strong>Profiles APIs</strong> when the checkbox is not set).
            <br />
            This option may be useful if you want to validate which are the names of the attributes that can be modified by the <strong style="color:red">ProfilesSet</strong> node.
            <br />
            Use this option <strong style="color:red">ONLY if</strong><strong> the associated Login node has the Administration Privileges on the Profiles Application</strong>
        </dd>
    </dl>

    <h3>Outputs</h3>
    <dl class="message-properties">
        <dt>msg.payload
            <span class="property-type">object or Array of Objects</span>
        </dt>
        <dd>
            The details that are returned for any retrieved profile are the following:
            <img src="icons/node-red-contrib-ibmconnections/getProfiles-commonAttributes.png" />
            The node returns a <strong>single object</strong> in case you elicit to retrieve information for <code>myself</code>. Otherwise an <strong>array of objects</strong> is returned. 
            <br />
            The <code>payload</code> output attribute consists of the following attributes:
            <dl class="message-properties">
                <dt>userId
                    <span class="property-type">string</span>
                </dt>
                <dd>
                    The IBM connections's userId for the user
                </dd>
                <dt>key
                    <span class="property-type">string</span>
                </dt>
                <dd>
                    The IBM Connections's Key for the user
                </dd>
                <dt>mail
                    <span class="property-type">string</span>
                </dt>
                <dd>
                    The IBM Connections's email address for the user
                </dd>
                <dt>name
                    <span class="property-type">string</span>
                </dt>
                <dd>
                    The full name of the user
                </dd>
                <dt>title
                    <span class="property-type">string</span>
                </dt>
                <dd>
                    The title of the user
                </dd>
                <dt>photo
                    <span class="property-type">string</span>
                </dt>
                <dd>
                    The URL Link for the user's picture
                </dd>
                <dt>links
                    <span class="property-type">object</span>
                </dt>
                <dd>
                    An object containing all the links associated to the profile. Each link is itself an object qualified by an <i>href</i> and <i>type</i> attributes.
                    <img src="icons/node-red-contrib-ibmconnections/getProfiles-Links.png" />
                    Note that the number of Links returned depends on the query; all the Links are returned when you elicit to get the details for <i>me</i> or for <i>someone else</i>.
                    In the other situations, a certain number of links is not returned, mainly those associated to the extension attributes, to the Activity Stream and to the social graph.
                </dd>
                <dt>allAttributes
                    <span class="property-type">object</span>
                </dt>
                <dd>
                    An object grouping all the attributes for the given profile. The attributes (and their names) depend on the value of the <code>Admin Output</code> checkbox:
                    <ul>
                        <li>
                            if <strong>Admin Output is checked</strong>, the attributes are the ones retrived from the <code>content person com.ibm.snx_profiles.attrib</code> section of the 
                            <strong>Profiles Admin API</strong>.
                            <img src="icons/node-red-contrib-ibmconnections/getProfiles-allAttributesAdmin.png" />
                        </li>
                        <li>
                            if <strong>Admin Output is NOT checked</strong>, the attributes are in the exact same format as they appear from the IBM Connections's <b>vcard</b>
                            associated to the user (only some logical grouping have been proposed).<br />
                            Note the <code>x-extension-property</code> array which references all the IBM Connections extension attributes.
                            <img src="icons/node-red-contrib-ibmconnections/getProfiles-allAttributes.png" />
                        </li>
                    </ul>
                </dd>
                <dt>tags
                    <span class="property-type">Array</span>
                </dt>
                <dd>
                    An array where each items corresponds to one of the tags associated to the profile.
                </dd>
                <dt class="optional">tagCloud
                    <span class="property-type">Object/span>
                </dt>
                <dd>
                    This attribute will only be shown when the <strong>Admin Output</strong> checkbox is selected.
                    <br />
                    It is an object where each attribute has the name of one of the tags associated to the profile. For each tag, an object is attached with the following properties:
                    <ul>
                        <li><strong>frequency</strong><br />
                            The number of times this tag is associated to the user
                        </li>
                        <li><strong>visibility</strong><br />
                            The visibility of the tag
                        </li>
                        <li><strong>intensity</strong><br />
                            The intensity (used to build the Tag cloud)
                        </li>
                        <li><strong>contributors</strong><br />
                            This is an array of objects, where each object represents the details of the person who tagged, and has the following attributes:
                            <ul>
                                <li><strong>name</strong>
                                </li>
                                <li><strong>email</strong>
                                </li>
                                <li><strong>userId</strong>
                                </li>
                                <li><strong>key</strong>
                                </li>
                            </ul> 
                        </li>
                    </ul>
                    <img src="icons/node-red-contrib-ibmconnections/getProfiles-tagCloud.png" />
                </dd>
                <dt class="optional">photoBytes
                    <span class="property-type">string</span>
                </dt>
                <dd>
                    A String which contains the <i>base64</i> version of the Profile image. It is returned <strong>only</strong> if the <code>Photo Bytes</code> qualifier is checked.
                    This string can be directly written as a <strong>JPG</strong> file.
                    <img src="icons/node-red-contrib-ibmconnections/getProfiles-additionalPhotoBytes.png" />
                </dd>
                <dt class="optional">pronounciation
                    <span class="property-type">string</span>
                </dt>
                <dd>
                    A String which contains the audio for the pronounciation (if present, otherwise it is an empty string). It is returned <strong>only</strong> if the <code>Audio</code> qualifier is checked.
                    This string can be directly written to a <strong>WAV</strong> file.
                    <img src="icons/node-red-contrib-ibmconnections/getProfiles-additionalPronounciation.png" />
                </dd>
                <dt class="optional">linkroll
                    <span class="property-type">Array of Objects</span>
                </dt>
                <dd>
                    An Array of objects, where each item provides a <strong>name</strong and a <strong>url</strong> attributes. It is returned <strong>only</strong> if the <code>Linkroll</code> qualifier is checked.
                    <img src="icons/node-red-contrib-ibmconnections/getProfiles-additionalLinkroll.png" />
                </dd>
            </dl>
        </dd>
    </dl>

    <h3>Note</h3>
        If the processing fails or if mandatory inputs are missing, the node terminates with an error. 
        <br />
        The error object is the <strong>incoming msg object</strong> with the additional <code>msg.ICX_fatal</code> attribute which represents the reason for the error. 
        The <code>msg.error</code> output attribute may also be present depending on the processing at the moment of the error.
        <br />
        You may want to catch errors using the <b style="color:red">standard NodeRed CATCH Node</b> as show in the example here below:
        <img src="icons/node-red-contrib-ibmconnections/communityErrorCatching.png" />

</script>


<script type="text/javascript">
    /*
    Copyright IBM All Rights Reserved.
    
    SPDX-License-Identifier: Apache-2.0
    */
        RED.nodes.registerType(
            'ICProfilesSet',
            {
                category: "IBMsocial",
                inputs: 1,
                outputs:1,
                icon: "ibmconnections-alert.png",
                color: "#FFFFFF",
                label: function() {
                        return this.name ||'Set Profiles';
                },
                paletteLabel : "Set Profiles",
                defaults : {
                    name: {
                        value: ""
                    },
                    server: {
                        value: "",
                        required: true,
                        type: "ICLogin2"
                    },
                    target: {
                        value: "myself",
                        required: true
                    },
                    targetValue: {
                        value: "",
                        required: false
                    },
                    attributes: {
                        value: "",
                        required: false
                    },
                    profileTagsAdd: {
                        value: "",
                        required: false
                    },
                    profileTagsRemove: {
                        value: "",
                        required: false
                    },
                    resetTags: {
                        value: false,
                        required: false
                    },
                    fullOutput: {
                        value: false,
                        required: false
                    }
                },
                oneditprepare: __IC_updateFormProfilesSet
            });
    
        function __IC_updateFormProfilesSet() {
            if ((this.resetTags === undefined) || (this.resetTags === null)) {
                this.resetTags = false;
                document.querySelector("#node-input-resetTags").value = false;
                document.querySelector("#node-input-resetTags").checked = false;
            }
            if ((this.fullOutput === undefined) || (this.fullOutput === null)) {
                this.fullOutput = false;
                document.querySelector("#node-input-fullOutput").value = false;
                document.querySelector("#node-input-fullOutput").checked = false;
            }
            __IC_updateTargetProfilesSet();
            if ((document.querySelector("#node-input-target").value === 'person') || (document.querySelector("#node-input-target").value === 'myself')) {
                if (this.resetTags) {
                    document.querySelector("#profileTagsRemove").style.display = "none";
                } else {
                    document.querySelector("#profileTagsRemove").style.display = "block";
                }
            }
        }

        function __IC_updateTargetProfilesSet() {
            switch (document.querySelector("#node-input-target").value) {
                case 'person' :
                    document.querySelector("#targetRow").style.display = "block";
                    document.querySelector("#attributesRow").style.display = "block";
                    document.querySelector("#profileTagsAdd").style.display = "block";
                    document.querySelector("#profileTagsRemove").style.display = "block";
                    document.querySelector("#userInformation2").style.display = "block";
                    document.querySelector("#userInformation3").style.display = "none";
                    break;
                case 'fromMsg' :
                    document.querySelector("#targetRow").style.display = "none";
                    document.querySelector("#attributesRow").style.display = "none";
                    document.querySelector("#profileTagsAdd").style.display = "none";
                    document.querySelector("#profileTagsRemove").style.display = "none";
                    document.querySelector("#userInformation2").style.display = "none";
                    document.querySelector("#userInformation3").style.display = "none";
                    break;
                case 'myself' :
                    document.querySelector("#targetRow").style.display = "none";
                    document.querySelector("#attributesRow").style.display = "block";
                    document.querySelector("#profileTagsAdd").style.display = "block";
                    document.querySelector("#profileTagsRemove").style.display = "block";
                    document.querySelector("#userInformation2").style.display = "block";
                    document.querySelector("#userInformation3").style.display = "none";
                    break;
                case 'editable' :
                    document.querySelector("#targetRow").style.display = "none";
                    document.querySelector("#attributesRow").style.display = "none";
                    document.querySelector("#profileTagsAdd").style.display = "none";
                    document.querySelector("#profileTagsRemove").style.display = "none";
                    document.querySelector("#userInformation2").style.display = "none";
                    document.querySelector("#userInformation3").style.display = "block";
                    break;
            }
        }

        function __IC_updateTargetProfilesTags() {
            if ((document.querySelector("#node-input-target").value === 'person') || (document.querySelector("#node-input-target").value === 'myself')) {
                if (document.querySelector("#node-input-resetTags").checked) {
                    document.querySelector("#profileTagsRemove").style.display = "none";
                } else {
                    document.querySelector("#profileTagsRemove").style.display = "block";
                }
            } else {
                document.querySelector("#profileTagsRemove").style.display = "none";
            }
        }
    </script>
    
    <script type="text/x-red" data-template-name="ICProfilesSet">
        <div class="form-row">
            <label for="node-input-server"><i class="fa fa-server"></i> Server</label>
            <input type="text" id="node-input-server" placeholder="Server">
        </div>
    
        <div class="form-row">
            <label for="node-input-target"><i class="fa fa-arrow-circle-right"></i> Target</label>
            <select id="node-input-target" onchange="__IC_updateTargetProfilesSet()">
               <option value="myself">Me</option>
               <option value="person">Someone else</option>
               <option value="fromMsg">--set from msg.IC_attributesByUser--</option>
               <option value="editable">List of Editable Attributes</option>
            </select>
        </div>
        <div class="form-row" id="targetRow">
            <label for="node-input-targetValue"><i class="fa fa-odnoklassniki"></i> Users</label>
            <input type="text" id="node-input-targetValue" placeholder="comma-separated list of User ID"></input>
        </div>
        <div class="form-row" id="attributesRow">
            <label for="node-input-attributes"><i class="fa fa-list"></i> Attributes</label>
            <input type="text" id="node-input-attributes" placeholder="comma-separated list 'name = value' pairs"></input>
        </div>

        <div class="form-row" id="profileTagsAdd">
            <label for="node-input-profileTagsAdd"><i class="fa fa-tags"></i> Tags to Add</label>
            <input type="text" id="node-input-profileTagsAdd" placeholder="comma-separated list of tags(user, user...)" style="width:60%"/>
            <div style="float: right">
                <label for="node-input-resetTags" style="width: initial"> Reset</label>
                <input type="checkbox" name="resetTags" id="node-input-resetTags" style="width: initial" onchange="__IC_updateTargetProfilesTags()"/>
            </div>
        </div>

        <div class="form-row" id="profileTagsRemove">
            <label for="node-input-profileTagsRemove"><i class="fa fa-tags"></i> Tags to Remove</label>
            <input type="text" id="node-input-profileTagsRemove" placeholder="comma-separated list of tags(user, user...)"/>
        </div>
    
        <div class="form-tips" id="userInformation2" style="display:none; max-width:100%">
            <h4>Info</h4>
            <ul>
                <li><strong>Attributes</strong><br />
                    The comma-separated list of <code>name = value</code> pairs will be applied to <strong style="color:red">ALL</strong> the selected Users !
                    <br />
                    The <code>value</code> must be envclosed in single or double quotes.
                </li>
                <li><strong>Tags to Add</strong><br />
                    To add new tags to <strong style="color:red">ALL</strong> the selected users, use the syntax <code>user1 (tag1, tag2, ...), user2 (tag3, ...), ...</code> 
                    in the <strong>Tags to Add</strong> input.
                    <br />
                    This means that node will add the given tag (for instance <i>tag1</i>) to ALL selected users <strong>on behalf</strong> of <strong>user1</strong>>.
                    <br />
                    The user can be specified either as an email address or by it IBM Connections Uuid.
                    <br />
                    When checking the <strong>Reset</strong> checkbox, the tags will not be <strong>added</strong> but will <strong>replace</strong> any previously existing tags 
                    from the tagging user and, obviously, the <strong>Tags to Remove</strong> input will not be available.
                </li>
                <li><strong>Tags to Remove</strong><br />
                    To remove tags to <strong style="color:red">ALL</strong> the selected users, use the syntax <code>user1 (tag1, tag2, ...), user2 (tag3, ...), ...</code>
                    in the <strong>Tags to Remove</strong> input.
                    <br />
                    This means that node will remove the given tag (for instance <i>tag1</i>) to ALL selected users and <strong>on behalf</strong> of <strong>user1</strong>>.
                    <br />
                    The user can be specified either as an email address or by it IBM Connections Uuid.
                </li>
            </ul>
        </div>

        <div class="form-tips" id="userInformation3" style="display:none; max-width:100%">
            <h4>Info</h4>
            <p>This option is <strong style="color:red">just a convenience</strong> for you in order to see which are the names of the attributes you could change using this node.</p>
        </div>
        
        <br/>
        <br/>
    
    
        <label><b>Output Options</b></label>
        <hr style="margin:5px; border-color:black"/>
    
        <div class="form-row" id="fullOutput">
            <label for="node-input-fullOutput" style="width:fit-content"><i class="fa fa-battery-full" style="width: initial"></i> Full Output</label>
            <input style="display: inline-block; width: initial; vertical-align: top;" type="checkbox" name="links" id="node-input-fullOutput"></input>
        </div>
        
    
        <hr style="margin:5px; border-color:black"/>
        <br/>
        <div class="form-row">
            <label for="node-input-name"><i class="fa fa-tag"></i> Name</span></label>
            <input type="text" id="node-input-name" ></input>
        </div>
    
    </script>
    
    <script type="text/x-red" data-help-name="ICProfilesSet">
        <p>
            A node that allows you to update <strong>any editable attribute and/or tag of any other user</strong> within the same organization. 
            <br />
            <dl class="message-properties" style="border:5px solid black">
                <strong style="color:red">This node requires to be associated with a LOGIN node attached to a user who has the Profile Administrator role for the organization.</strong>
                <ul>
                    <li>
                        If <strong>on premises</strong>, this means that the user attached to the LOGIN node is in the <code>admin role</code> for the Profile application.
                    </li>
                    <li>
                        If <strong>in cloud</strong>, this means that the user has the <code>Administrator role</code> for the Organization <strong style="color:red">AND</strong> the organization
                        itself has been granted the <strong>delegation flag</strong>
                    </li>
                </ul>
            </dl>
            You can update:
            <ul>
                <li>
                    the profile attributes and/or tags for the same user associated to the LOGIN node
                </li>
                <li>
                    the profile attributes and/or tags for a set of users identified by their userid or email address.
                    <br />
                    In this case:
                    <ul>
                        <li>
                            You can specify the same values for the attributes and/or tags that will be applied to all the selected users
                        </li>
                        <li>
                            Or you can specify for each selected user a different sets of values for a different set of attributes
                        </li>
                    </ul>
                </li>
            </ul>
        </p>
    
        <h3>Input Options</h3>
        <dl class="message-properties">
            <dt>Target
                <span class="property-type">option list</span>
            </dt>
            <dd>
                You can select any of the following options:
                <ul>
                    <li>
                        <strong>Me</strong><br />
                        If you want to modify the attributes and/or tags of the same user associated with the LOGIN node
                    </li>
                    <li>
                        <strong>Someone Else</strong><br />
                        If you want to modify the attributes and/or tags of the one or more users within the same organization of the user associated with the LOGIN node.
                        <br />
                        In this case, all the users will get updated with the same attributes and attribute values (and/or tags). 
                    </li>
                    <li>
                        <strong>Set from msg.IC_attributesByUser</strong><br />
                        If you want to modify the attributes and/or tags of one or more users within the same organization of the user associated with the LOGIN node.
                        <br />
                        In this case you will be able to specify different attributes to be modified (and/or different values) for each of the selected users.
                    </li>
                    <li>
                        <strong>List of editable Attributes</strong><br />
                        This option simply lists the <strong>editable attributes</strong> for the users in the organization.  It is not an <i>operational</i> option, but can be useful
                        if you do not know which attributes can be modified or which is the exact name of the attributes to be modified.
                    </li>
                </ul>
            </dd>

            <dt>Reset
                <span class="property-type">checkbox</span>
            </dt>
            <dd>
                In case you choose to change the values of some attribute (and/or tags) for <b style="color:red">me</b> or <b style="color:red">someone else</b>, you 
                are offered the possibility to specify which are the Tags that will be added to ALL the selected Users.
                <br />
                Checking the <strong>Reset</strong> checkbox implies that the Tags that will be specified will not be added to the existing tags, but <strong>will replace any existing tag</strong>.
                You need to <strong style="color:red">use this option with care</strong>.
                <br />
                This flag can only be set from the Configuration Panel.
            </dd>
        </dl>
    
        <h3>Inputs</h3>
        <dl class="message-properties">
            <dt class="optional">msg.IC_target
                <span class="property-type">comma-separated string</span>
            </dt>
            <dd>
                In case you choose to change the values of some attribute (and/or tags) for <b style="color:red">someone else</b>, you need to specify a comma-separated list of 
                <code>IBM Connections's userId</code> or <code>email address</code> for
                the users whose profile you want to modify. The node is able to automatically distinguish between userIds and email addresses and you can mix them.
                <ul>
                    <li>
                        An example of the syntax is the following: <code>21513549, abc.xyzy@mydomain.com</code>.
                    </li>
                    <li>
                        If only one user is specified, the <code>msg.payload</code> output will be a single object (or <b>null</b> if the user is not found); 
                        otherwise, <code>msg.payload</code> will be an array of objects (or an <b>empty array</b> if no users are found).
                    </li>
                    <li>
                        The value from the <b>node's Configuration Panel</b> takes precedence on the <code>msg.IC_target</code> attribute.
                    </li>
                </ul>
            </dd>

            <dt class="optional">msg.IC_profileAttributes
                <span class="property-type">comma-separated list of name=value</span>
            </dt>
            <dd>
                In case you choose to change the values of some attribute (and/or tags) for <b style="color:red">me</b> or <b style="color:red">someone else</b>, you need to specify 
                a comma-separated list of <code>attributeName = "attributeValue"</code> pairs. 
                <ul>
                    <li>
                        Each <strong>attributeValue</strong> can be enclosed in <i>double or single quotes</i> or can be used without enclosure.
                    </li>
                    <li>
                        The change to these attributes will be applied to all the selected users. 
                    </li>
                    <li>
                        An example of the syntax is the following: <code>com.ibm.snx_profiles.base.bldgId = "Brussels", com.ibm.snx_profiles.base.faxNumber = "5678"</code>.
                    </li>
                    <li>
                        The value from the <b>node's Configuration Panel</b> takes precedence on the <code>msg.IC_profileAttributes</code> attribute.
                    </li>
                </ul>
            </dd>

            <dt class="optional">msg.IC_profileTagsToAdd
                <span class="property-type">comma-separated string</span>
            </dt>
            <dd>
                In case you choose to change the values of some attribute (and/or tags) for <b style="color:red">me</b> or <b style="color:red">someone else</b>, you need 
                to specify the tags to be added (and the users on behanlf of which those tags are added).
                <br />
                The node is able to tag a person (speified by the <code>msg.IC_target</code> input or its equivalent from the Configuration Panel) <strong>on behalf of 
                another user</strong> (who may not be the same user associated to the LOGIN node and which is specified in the text of this input attribute). So you may 
                chose to have <strong>user2 and user3</strong> to tag <strong>user2</strong> with the <i>tag1</i> tag using the following syntax:
                <br />
                <code>user1 (tag1), user3 (tag1).</code>
                <br />
                In general the syntax is the following: <code>user1 (tag1, tag2, ...), user3 (tag3, ...), ...</code>, which means that <strong>user1</strong> adds  
                the <strong> tag1, tag2 and other tags</strong> and <strong>user3</strong> adds <strong>tag3 and other tags</strong>.
                <br />
                <strong>No Error</strong> will be generated if the tag to be added is already present.
                <br />
                The user can be specified either as an email address or by it IBM Connections Uuid.
                <br />
                The value from the <b>node's Configuration Panel</b> takes precedence on the <code>msg.IC_profileTagsToAdd</code> attribute.
            </dd>

            <dt class="optional">msg.IC_profileTagsToRemove
                <span class="property-type">comma-separated string</span>
            </dt>
            <dd>
                In case you choose to change the values of some attribute (and/or tags) for <b style="color:red">me</b> or <b style="color:red">someone else</b>, you need 
                to specify the tags to be added (and the users on behanlf of which those tags are added).
                <br />
                <br />
                The node is able to remove a tag from a person (speified by the <code>msg.IC_target</code> input or its equivalent from the Configuration Panel) 
                <strong>on behalf of another user</strong> (who may not be the same user associated to the LOGIN node and which is specified in the text of this input 
                attribute). So you may chose to have <strong>user2 and user3</strong> to UNtag <strong>user2</strong> with the <i>tag1</i> tag using the following syntax:
                <br />
                <code>user1 (tag1), user3 (tag1).</code>
                <br />
                In general the syntax is the following: <code>user1 (tag1, tag2, ...), user3 (tag3, ...), ...</code>, which means that <strong>user1</strong> removes  
                the <strong> tag1, tag2 and other tags</strong> and <strong>user3</strong> removes <strong>tag3 and other tags</strong>.
                <br />
                <strong>No Error</strong> will be generated if the tag to be added is already present.
                <br />
                The user can be specified either as an email address or by it IBM Connections Uuid.
                <br />
                The value from the <b>node's Configuration Panel</b> takes precedence on the <code>msg.IC_profileTagsToAdd</code> attribute.
            </dd>         
    
            <dt class="optional">msg.IC_attributesByUser
                <span class="property-type">Array of Objects</span>
            </dt>
            <dd>
                In case you choose to change the values of some attribute (and/or tags) for <b style="color:red">Set from msg.IC_attributesByUser</b>, you need to specify 
                an array providing the required information. 
                <br />
                As previously stated, this option allows you to select which are the attributes and/or the values to be modified for each of the selected users (as opposed to set the 
                same value for the same attributes for all the selected users). Given the complexity, this information <strong>can only be specified as an input parameter</strong> 
                (it does not have a Configuration Panel equivalent).
                <br />
                Hrre is an example of the syntax that can be used:
                <pre>
msg.IC_attributesByUser = [];
msg.IC_attributesByUser[0] = {};
msg.IC_attributesByUser[0].user = '1A2F3AC4-83DB-8733-8625-80CC006C043A';
msg.IC_attributesByUser[0].attributes = [];
msg.IC_attributesByUser[0].attributes[0] = {};
msg.IC_attributesByUser[0].attributes[0].name = "com.ibm.snx_profiles.base.officeName";
msg.IC_attributesByUser[0].attributes[0].value = "Name of Office";
msg.IC_attributesByUser[0].attributes[1] = {};
msg.IC_attributesByUser[0].attributes[1].name = "com.ibm.snx_profiles.base.mobileNumber";
msg.IC_attributesByUser[0].attributes[1].value = "123-456-789";
msg.IC_attributesByUser[0].taggingUsers = [];
msg.IC_attributesByUser[0].taggingUsers[0] = {};
msg.IC_attributesByUser[0].taggingUsers[0].user = "userID_1";
msg.IC_attributesByUser[0].taggingUsers[0].resetTags = false;
msg.IC_attributesByUser[0].taggingUsers[0].tags = [];
msg.IC_attributesByUser[0].taggingUsers[0].tags[0] = {};
msg.IC_attributesByUser[0].taggingUsers[0].tags[0].tagName = 'tag1';
msg.IC_attributesByUser[0].taggingUsers[0].tags[0].operation = 'add';
msg.IC_attributesByUser[0].taggingUsers[0].tags[1] = {};
msg.IC_attributesByUser[0].taggingUsers[0].tags[1].tagName = 'tag2';
msg.IC_attributesByUser[0].taggingUsers[0].tags[1].operation = 'add';
msg.IC_attributesByUser[0].taggingUsers[0].tags[2] = {};
msg.IC_attributesByUser[0].taggingUsers[0].tags[2].tagName = 'tag3';
msg.IC_attributesByUser[0].taggingUsers[0].tags[2].operation = 'remove';
msg.IC_attributesByUser[0].taggingUsers[1] = {};
msg.IC_attributesByUser[0].taggingUsers[1].user = "userID_1";
msg.IC_attributesByUser[0].taggingUsers[1].resetTags = false;
msg.IC_attributesByUser[0].taggingUsers[1].tags = [];
msg.IC_attributesByUser[0].taggingUsers[1].tags[0] = {};
msg.IC_attributesByUser[0].taggingUsers[1].tags[0].tagName = 'tag1';
msg.IC_attributesByUser[0].taggingUsers[1].tags[0].operation = 'add';
msg.IC_attributesByUser[0].taggingUsers[1].tags[1] = {};
msg.IC_attributesByUser[0].taggingUsers[1].tags[1].tagName = 'tag2';
msg.IC_attributesByUser[0].taggingUsers[1].tags[1].operation = 'add';
msg.IC_attributesByUser[0].taggingUsers[1].tags[2] = {};
msg.IC_attributesByUser[0].taggingUsers[1].tags[2].tagName = 'tag3';
msg.IC_attributesByUser[0].taggingUsers[1].tags[2].operation = 'remove';

msg.IC_attributesByUser[1] = {
    user : "theUser@domain.com",
    attributes : [
        {
            name: "com.ibm.snx_profiles.base.officeName",
            value: 'Paris'
        },
        {
            name: "com.ibm.snx_profiles.base.blogUrl",
            value: 'http://this.com'
        }
    ],
    taggingUsers : [
        {
            user: 'userID_3',
            resetTags : true,
            tags: [
                {
                    tagName: 'tag3',
                    operation: 'add'
                },
                {
                    tagName: 'tag4',
                    operation: 'add'
                }
            ]
        },
        {
            user: 'second@domain.com',
            resetTags : false,
            tags; [
                {
                    tagName: 'tag5',
                    operation: 'add'
                },
                {
                    tagName: 'tag6',
                    operation: 'remove'
                }
            ]
        }
    ]
};

                </pre>                        
            </dd>            
        </dl>

        <h3>Output Options</h3>
        <dl class="message-properties">
            <dt>Full Output
                <span class="property-type">checkbox</span>
            </dt>
            <dd>
                when this checkbox is set, the <code>msg.payload</code> output will provide the same output as the one given by the <strong>Get Profiles node</strong> when the
                <strong>Admin Output</strong> option is selected.
                <br />
                Otherwise each item of the <code>msg.payload</code> array will be empty.
            </dd>
        </dl>
    
        <h3>Outputs</h3>
        <dl class="message-properties">
            <dt>msg.payload
                <span class="property-type">object or Array of Objects</span>
            </dt>
            <dd>
                The details that are returned depend of the <code>Full Output</code> option.
            </dd>
        </dl>
        
        <h3>Note</h3>
            If the processing fails or if mandatory inputs are missing, the node terminates with an error. 
            <br />
            The error object is the <strong>incoming msg object</strong> with the additional <code>msg.ICX_fatal</code> attribute which represents the reason for the error. 
            The <code>msg.error</code> output attribute may also be present depending on the processing at the moment of the error.
            <br />
            You may want to catch errors using the <b style="color:red">standard NodeRed CATCH Node</b> as show in the example here below:
            <img src="icons/node-red-contrib-ibmconnections/communityErrorCatching.png" />
    
    </script>
    